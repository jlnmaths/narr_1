{{ block title }}
    Receiver Task
{{ endblock }}
{{ block content }}

<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Receiver Task</title>
<style>
  body {
    display: flex;
    justify-content: center;
    align-items: center;
    text-align: center;
    margin: 0;
    background-color: #f5f5f5;
  }

  #challengeSection {
    display: none;
  }

  .container {
    background-color: #ffffff;
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
    width: 80%;
  }

  .row {
    display: flex;
    align-items: center;
    margin-bottom: 20px;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
  }

  .column {
    flex: 1;
    align-items: left;
    padding: 10px;
  }

  .image {
    max-width: 100%;
  }

  label {
    display: block;
    margin-bottom: 5px;
  }

  input[type="text"], input[type="radio"] {
    margin-bottom: 10px;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    table-layout: fixed;
  }

  th, td {
    border: 1px solid black;
    padding: 8px;
    text-align: left;
  }

  .hidden {
    display: none;
  }
</style>
<script>
function toggleDataVisibility() {
    var hidden = document.querySelectorAll('.hidden');
    for (var i = 0; i < hidden.length; i++) {
      hidden[i].style.display = "table-row";
    }
    liveSend(1);
  }


  function toggleTextVisibility() {
    var textDiv2 = document.getElementById("textDiv2");
    var radioDiv = document.getElementById("radioDiv");

    textDiv2.style.display = textDiv2.style.display === "none" ? "block" : "none";
    radioDiv.style.display = radioDiv.style.display === "none" ? "block" : "none";
    document.getElementById("toggleTextButton").style.display = "none";
    liveSend(2);
  }
function generateRandomSequence() {
    var characters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
    var sequence = "";

    for (var i = 0; i < 5; i++) {
      var randomIndex = Math.floor(Math.random() * characters.length);
      sequence += characters.charAt(randomIndex);
    }

    return sequence;
  }

  function startChallenge(index) {
    var sequence = generateRandomSequence();
    var challengeSection = document.getElementById("challengeSection");
    var challengeText = document.getElementById("challengeText");
    var inputField = document.getElementById("inputField");
    var submitButton = document.getElementById("submitButton");

    if (index === 1) {
      liveSend(3);
    }
    if (index === 2) {
      liveSend(4);
    }

    alert("Um die gewünschte Zusatzinformation zu sehen, lösen Sie bitte das Captcha unten!");
    challengeText.textContent = sequence;
    inputField.value = "";
    challengeSection.style.display = "block";
    submitButton.onclick = function () {
      checkAnswer(sequence, index);
    };
  }

  function checkAnswer(expectedSequence, index) {
    var inputField = document.getElementById("inputField");
    var userSequence = inputField.value;

    if (userSequence === expectedSequence.split('').reverse().join('')) {
      alert("Richtig! Die gewünschte Zusatzinformation wird angezeigt.");
      var challengeSection = document.getElementById("challengeSection");
      challengeSection.style.display = "none";
      if (index === 1) {
        var moreDataButton = document.getElementById("btnrow");
        moreDataButton.style.display = "none";
        toggleDataVisibility();
      }
      if (index === 2) {
        var moreTextButton = document.getElementById("toggleTextButton");
        moreTextButton.style.display = "none";
        toggleTextVisibility();
      }
    } else {
      alert("Das war leider falsch.");
    }
  }
</script>
</head>
<body>
  <div class="container">
    <div class="row">
      <div class="column">
        Bitte geben Sie in das Textfeld unten die Wahrscheinlichkeit ein, mit der Sie glauben, dass die Hauptbeobachtung hinter dem Fragezeichen eine 1 ist. Sie können mehr Daten oder eine zweite Meinung heranziehen. Sollten Sie sich für eine oder beide dieser beiden Möglichkeiten entscheiden, müssen Sie zunächst beweisen, dass Sie kein Roboter sind, indem Sie ein Captcha lösen.
      </div>
    </div>
    <div class="row">
      <div class="column">
        <table>
          <thead>
            <tr>
              <th>HB</th>
              <th>NB 1</th>
              <th>NB 2</th>
              <th>NB 3</th>
            </tr>
          </thead>
          <tbody>
            <tr class="hidden">
              <td>{{ hb.0 }}</td>
              <td>{{ nb_1.0 }}</td>
              <td>{{ nb_2.0 }}</td>
              <td>{{ nb_3.0 }}</td>
            </tr>
            <tr class="hidden">
              <td>{{ hb.1 }}</td>
              <td>{{ nb_1.1 }}</td>
              <td>{{ nb_2.1 }}</td>
              <td>{{ nb_3.1 }}</td>
            </tr>
            <tr class="hidden">
              <td>{{ hb.2 }}</td>
              <td>{{ nb_1.2 }}</td>
              <td>{{ nb_2.2 }}</td>
              <td>{{ nb_3.2 }}</td>
            </tr>
            <tr class="hidden">
              <td>{{ hb.3 }}</td>
              <td>{{ nb_1.3 }}</td>
              <td>{{ nb_2.3 }}</td>
              <td>{{ nb_3.3 }}</td>
            </tr>
            <tr>
              <td>{{ hb.4 }}</td>
              <td>{{ nb_1.4 }}</td>
              <td>{{ nb_2.4 }}</td>
              <td>{{ nb_3.4 }}</td>
            </tr>
            <tr>
              <td>{{ hb.5 }}</td>
              <td>{{ nb_1.5 }}</td>
              <td>{{ nb_2.5 }}</td>
              <td>{{ nb_3.5 }}</td>
            </tr>
            <tr>
              <td>{{ hb.6 }}</td>
              <td>{{ nb_1.6 }}</td>
              <td>{{ nb_2.6 }}</td>
              <td>{{ nb_3.6 }}</td>
            </tr>
            <tr>
              <td>{{ hb.7 }}</td>
              <td>{{ nb_1.7 }}</td>
              <td>{{ nb_2.7 }}</td>
              <td>{{ nb_3.7 }}</td>
            </tr>
            <tr>
              <td>{{ hb.8 }}</td>
              <td>{{ nb_1.8 }}</td>
              <td>{{ nb_2.8 }}</td>
              <td>{{ nb_3.8 }}</td>
            </tr>
            <tr>
              <td>{{ hb.9 }}</td>
              <td>{{ nb_1.9 }}</td>
              <td>{{ nb_2.9 }}</td>
              <td>{{ nb_3.9 }}</td>
            </tr>
            <tr>
              <td>{{ hb.10 }}</td>
              <td>{{ nb_1.10 }}</td>
              <td>{{ nb_2.10 }}</td>
              <td>{{ nb_3.10 }}</td>
            </tr>
            <tr>
              <td>{{ hb.11 }}</td>
              <td>{{ nb_1.11 }}</td>
              <td>{{ nb_2.11 }}</td>
              <td>{{ nb_3.11 }}</td>
            </tr>
            <tr>
              <td>?</td>
              <td>{{ nb_1.12 }}</td>
              <td>{{ nb_2.12 }}</td>
              <td>{{ nb_3.12 }}</td>
            </tr>
          </tbody>
        </table>

      </div>
    </div>
    <div class="row" id="btnrow">
      <div class="column">
        <button type="button" id="toggleDataButton" onclick="startChallenge(1)">Mehr Daten</button>
      </div>
    </div>
    <div class="row" id="challengeSection">
      <h2>CAPTCHA: Geben Sie diese Buchstabenfolge in umgekehrter Reihenfolge ein!</h2>
      <p id="challengeText"></p>
      <input type="text" id="inputField">
      <button type = "button" id="submitButton">Antwort überprüfen</button>
    </div>
    <div class="row">
      <div class="column">
        <div class="text">
          <p>Immer, wenn NB {{ plus }} und NB{{ join }} gleich 1, ist auch die Hauptbeobachtung =1.</p>
        </div>
      </div>
      <div class="column">
        <div class="text">
          <button type="button" id="toggleTextButton" onclick="startChallenge(2)">Zweite Erklärung</button>
          <p id="textDiv2" style="display: none;">Immer, wenn NB {{ plus }} und NB{{ join }} gleich 1, ist auch die Hauptbeobachtung gleich 1.</p>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="column">
          <label for="assessment">Was denken Sie, ist die Wahrscheinlichkeit, dass die Hauptbeobachtung hinter dem Fragezeichen eine 1 ist?
          </label>
          <input type="text" id="assessment" name="assessment"> %.
              {{ formfield_errors 'assessment' }}
      </div>
    </div>
    <div class = "row">
      <div class="column">
      {{ next_button }}
      </div>
    </div>
  </div>
</body>
{{  endblock  }}